<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Attendance Check</title>
...
</head>
<body>
<!-- ใช้โค้ด HTML เหมือนเดิม แต่มีส่วน script ที่ส่วนตั้งค่า API_BASE -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const API_BASE = (function(){
  // ถ้ารันบน localhost during dev ใช้ localhost:3000
  // ถ้า deploy ที่ Render ให้ตั้งเป็น URL ของ render เช่น "https://your-service.onrender.com"
  return window.API_BASE || location.origin; // คุณสามารถแก้ค่า window.API_BASE ในหน้า HTML หรือเมื่อ deploy ให้ตั้ง env
})();

const students = ["นักเรียน 1","นักเรียน 2", /* ... */ "นักเรียน 16"];

function login(){ /* เหมือนเดิม */ }

/* ฟังก์ชันที่ติดต่อ backend */
async function loadToday(){
  try{
    const date = new Date().toISOString().split('T')[0];
    const res = await fetch(API_BASE + '/attendance');
    const data = await res.json();
    if(data[date]){
      students.forEach((_,i)=>{
        const el = document.getElementById(`chk_${i}`);
        if(el) el.checked = data[date][i];
      });
    }
  }catch(e){
    console.error('Cannot load from API, fallback to localStorage', e);
    // Optionally fallback to localStorage or show message
  }
}

async function saveAttendance(){
  const date = new Date().toISOString().split('T')[0];
  const status = students.map((_,i)=>document.getElementById(`chk_${i}`).checked);
  await fetch(API_BASE + '/attendance', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({date, status})
  });
  document.getElementById('status').innerText='บันทึกเรียบร้อยแล้ว!';
}

/* exportCSV/exportXLSX/showDashboard เหมือนเดิม */
</script>
</body>
</html>
